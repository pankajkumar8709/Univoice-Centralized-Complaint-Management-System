<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hostel Basic Amenities Complaints</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 20px;
        }
        .hostel-card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .card-icon {
            font-size: 2rem;
            color: #6c63ff;
            margin-bottom: 10px;
        }
        .table-section {
            display: none;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        th {
            background: #f1f3f5;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            color: white;
        }
        .status-resolved {
            background: #28a745;
        }
        .status-pending {
            background: #ffc107;
            color: #333;
        }
        .status-in-progress {
            background: #17a2b8;
        }
        .action-btn {
            background: #6c63ff;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
        }
        .modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            display: none;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            width: 400px;
            animation: fadeIn 0.3s ease-in-out;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
        }
        label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }
        select, textarea, input[type="date"] {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        button[type="submit"] {
            margin-top: 15px;
            width: 100%;
            background: #6c63ff;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="hostel-complaints-container">
    <div class="hostel-card animate__animated animate__fadeInUp" onclick="toggleTable('hostels')">
        <i class="fas fa-bed card-icon"></i>
        <h4>Basic Amenities Related Complaints</h4>
        <p>View all problems reported by students.</p>
    </div>

    <div class="table-section" id="hostels">
        <h3><i class="fas fa-bed"></i> Basic Amenities Related Complaints</h3>
        {% if complaints %}
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Complaint Details</th>
                    <th>Category</th>
                    <th>Date of Complaint</th>
                    <th>Status</th>
                    <th>Response </th>
                    <th>Resolved On</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for complaint in complaints %}
                <tr data-id="{{ complaint.id }}">
                    <td>{{ complaint.id }}</td>
                    <td>{{ complaint.complaint }}</td>
                    <td>{{ complaint.category }}</td>
                    <td>{{ complaint.date }}</td>
                    <td>
                        <span class="status-badge 
                            {% if complaint.status == 'Resolved' %}status-resolved
                            {% elif complaint.status == 'Pending' %}status-pending
                            {% else %}status-in-progress{% endif %}">
                            {{ complaint.status or 'Pending' }}
                        </span>
                    </td>
                    <td>{{ complaint.response|truncate(30, true, '...') if complaint.response else 'No response' }}</td>
                    <td>{{ complaint.date_resolved or '-' }}</td>
                    <td>
                        <button class="action-btn manage-btn"
                            data-id="{{ complaint.id }}"
                            data-status="{{ complaint.status }}"
                            data-response="{{ complaint.response or '' }}"
                            data-date="{{ complaint.date_resolved }}">
                            Manage
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="no-complaints">
            <i class="fas fa-inbox"></i>
            <p>No hostel complaints found</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Complaint Management Modal -->
<div class="modal" id="complaint-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Manage Complaint</h3>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <form id="update-form">
            <input type="hidden" name="id" id="complaint-id">
            <label for="status">Status:</label>
            <select name="status" id="status">
                <option value="Pending">Pending</option>
                <option value="In Progress">In Progress</option>
                <option value="Resolved">Resolved</option>
            </select>
            <label for="response">Response:</label>
            <textarea name="response" id="response" rows="3"></textarea>
            <label for="date_resolved">Date Resolved:</label>
            <input type="date" name="date_resolved" id="date_resolved">
            <button type="submit">Update</button>
        </form>
    </div>
</div>

<script>
    function toggleTable(id) {
        const section = document.getElementById(id);
        section.style.display = section.style.display === 'block' ? 'none' : 'block';
    }

    const modal = document.getElementById('complaint-modal');
    const form = document.getElementById('update-form');

    document.querySelectorAll('.manage-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.getElementById('complaint-id').value = btn.dataset.id;
            document.getElementById('status').value = btn.dataset.status;
            document.getElementById('response').value = btn.dataset.response;
            document.getElementById('date_resolved').value = btn.dataset.date || '';
            modal.style.display = 'flex';
        });
    });

    function closeModal() {
        modal.style.display = 'none';
    }

    form.addEventListener('submit', e => {
        e.preventDefault();
        const formData = new FormData(form);
        fetch('/update-basic-complaint', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if(data.success) {
                alert('Complaint updated successfully');
                location.reload();
            } else {
                alert('Error updating complaint');
            }
        });
    });

    window.onclick = e => {
        if(e.target === modal) {
            closeModal();
        }
    };
</script>

</body>
</html>
